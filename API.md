# API Documentation

# GET

## Getting all Toys

```/api/v1/toys```

This returns all toys from the database collection called `Toys`.

>_id: ObjectId of the toy

>brand: [ "Lego", "Barbie", "Hot Wheels", "American Girl", "Fisher-Price", "Nerf", "Hasbro", "Other" ]

>category: [ "Action Figures", "Dolls", "Animals", "Cars", "Education", "Electronic Toys", "Games and Puzzles", "Other" ]

>condition: [ "New", "Used: Like New", "Used: Very Good", "Used: Good" ]

>estimatedValue: Estimated value of the toy

>ageRange: [ "1-2", "2-3", "4-5", "6-7", "8+" ]

>description: toy’s description

>userId: user’s uid

>username: user’s username

>profileUrl: URL of user’s profile image

## Getting all Toys of a User

```/api/v1/toys/users/:userId```

This returns all toys that have been listed by a particular user from the database collection called `Toys`
 
## Getting a User

```/api/v1/users/:userId```

This returns a specific user from the database collection called `Users`
>_id: ObjectId of the user

>uid: user’s Google uid

>email: user’s email

>displayName: user’s display name

>photoURL: user’s Google photo URL

>username: user’s username

>zipcode: user’s zipcode

>bio: user’s bio

## Getting notifications for a particular user

```/api/v1/notifications/users/:userId```

This returns all of the notifications where the receiverId is `userId`.

>_id: ObjectId of the notification

>type: [“request”, “accept_acceptor”, “accept_receiver”, “message”, “confirm_transaction”, “transaction_receipt”]

>senderId: uid of sender

>receiverId: uid of receiver

>toyId: id of toy

>date: date notification was sent

>archived: whether or not the notification is archived

>senderUsername: username of the sender

>transactionId (optional): id of the transaction

>messageGroupId (optional): id of the message group

>status (optional): “accepted” or “deny” for the toy request

>toyName (optional): name of the toy

## Getting toys with a particular id

`/api/toys/:toyId`

This returns all of the toys where the ObjectId  `_id` is  `toyId`.

## Get Message Group

```/api/v1/messagegroups/:userId```

This `GET` request returns all of the message groups with a particular `userId` (either the userId1 field or userId2 field).

>_id: ObjectId of the message group

>userId1: id of user 1

>userId2: id of user 2

>date: date message group was created or date of most recent message sent

## Get Messages

```/api/v1/messages/:messageGroupId```

This is a `GET` request that returns all of the messages with a particular `messageGroupId`.

>_id: ObjectId of the message

>messageGroupId: id of the message group

>text: message body

>senderId: id of the sender

>receiverId: id of the receiver

>date: date the message was sent

## Getting Transaction By Id

```/api/v1/transactions/:transactionId```

This is a `GET` request that returns the transaction with a particular `transactionId`.

>_id: ObjectId of the transaction

>messageGroupId: id of message group between two users

>user1Id: user1’s uid

>user2Id: user2’s uid

>user1Toy: id of user1’s toy

>user2Toy: id of user2’s toy

>date: date the transaction was created

>status: [“pending”, “complete”, “failed”]

# POST

## Adding a User

```/api/v1/users/:uid```

A `User` object is posted in the database collection called `Users`

>uid: user id generated by Google OAuth

>email: Gmail

>displayName: Google Account Full Name

>photoURL: Google Account Image

## Adding a Toy

```/api/v1/toys```

A `Toy` object is posted in the database collection called `Toys`

>title: name of toy being added

>brand: [ "Lego", "Barbie", "Hot Wheels", "American Girl", "Fisher-Price", "Nerf", "Hasbro", "Other" ]

>category: [ "Action Figures", "Dolls", "Animals", "Cars", "Education", "Electronic Toys", "Games and Puzzles", "Other" ]

>condition: [ "New", "Used: Like New", "Used: Very Good", "Used: Good" ]

>estimatedValue: any dollar amount

>ageRange: [ "1-2", "2-3", "4-5", "6-7", "8+" ]

>description: description of toy being added

>userId: uid of user adding the toy

## Request a Toy

```/api/v1/notifications/request```

This sends a notification request to the user of the requested toy. It adds the following to the database collection called `Notifications`:

>type: [“request”, “accept_receiver”, “accept_acceptor”]

>senderId: ID of user who makes the request

>receiverId: ID of user who receives the request

>toyId: ID of toy being requested

## Accept Toy Request

```/api/v1/notifications/requests/accept/:requestId```

This is a `POST` request that creates two new notifications (one for each user), then a `PUT` request to archive the original notification request. It also inserts a message group document in the `MessageGroups` collection so that the two users may chat.

## Add Message

```/api/v1/messages/```

This is a ‘POST’ request that adds a message to the message chat. It also inserts a notification document in the `Notifications` collection for the receiver of the message.

## Make Transaction

```/api/v1/transactions/:transaction```

This is a `POST` request that handles the creation of a transaction and adds it to the Transactions collection. It also inserts a notification document in the `Notifications` collection so that the receiver of the transaction can either accept or deny the transaction.

# PUT

## Updates the New User

```/api/v1/users/:userId```

This updates a user with the given `userId` in the database collection called `Users`. It adds the following fields to the user:

>username

>zipcode

>bio

## Denying a Transaction

```/api/v1/transactions/deny/:transactionId```

This `PUT` request updates the transaction with a particular `transactionId` by setting the status to “failed”.

## Confirming a Transaction

```/api/v1/transactions/confirm/:transactionId```

The object being `PUT` is a `users` object, which contains the two users’ uids.

This request updates the transaction with a particular `transactionId` by setting the status to “complete”. It also creates two notification documents, one for each user to see the receipt of the completed transaction.

## Deny Toy Request

```/api/v1/notifications/requests/deny/:requestId```

This updates a particular request notification by setting archived to true.

## Archive Notification

```/api/v1/notifications/archives/:notificationId```

This is a `PUT` request that updates the field `archived` as `true` in the `Notifications` collection

# Data Visualization Requests

## Updating the Brands CSV File

```/api/v1/csv/brands```

This writes `brand` and `_id` for all of the documents in the collection `Toys` to the CSV file `brands.csv`.

## Updating the Toy Requests CSV File

```/api/v1/csv/toyrequests```

This writes `_id` and `toyId` for all of the documents in the collection `Notifications` to the CSV file `toyrequests.csv`.

## Updating the Age Ranges CSV File

```/api/v1/csv/ages```

This writes `ageRange` and `_id` for all of the documents in the collection `Toys` to the CSV file `ageRange.csv`.

## Updating User Toys CSV File

```/api/v1/csv/usertoys```

This writes `userId`, `brand`, and `_id` for all of the documents in the collection `Toys` to the CSV file `usertoys.csv`.

## Updating the Categories CSV File

```/api/v1/csv/categories```

This writes `category` and `_id` for all of the documents in the collection `Toys` to the CSV file `categories.csv`.

## Updating the User Requests CSV File
```/api/v1/csv/userrequests```

This writes `_id` and `receiverId` for all of the documents in the collection `Notifications` to the CSV file `user_requests.csv`.

## Updating the Conditions CSV file

```/api/v1/csv/conditions```

This writes `condition` and `_id` for all of the documents in the collection `Toys` to the CSV file `conditions.csv`.

## Updating the Sent Messages CSV File

```/api/v1/csv/sentmessages```

This writes `senderId` and `_id` for all of the documents in the collection `Messages` to the CSV file `sentmessages.csv`.
